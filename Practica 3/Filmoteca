#include <stdio.h>
#include <string.h>
#include <ctype.h>

#define MAX_PELICULAS 100
#define MIN_PELICULAS 10
#define MAX_DIRECTORES 5
#define MAX_LEN 100

struct Pelicula {
    char titulo[MAX_LEN];
    int anio;
    char genero[MAX_LEN];
    int numDirectores;
    char directores[MAX_DIRECTORES][MAX_LEN];
};

// Función que convierte una palabra o frase a minúsculas
void toLowerCase(char *str) {
    for (int i = 0; str[i]; i++) {
        str[i] = tolower((unsigned char)str[i]);
    }
}

void mostrarPeliculas(struct Pelicula peliculas[], int n) { //funcion mostrar todas las peliculas
    printf("\n--- Lista de películas ---\n");
    for (int i = 0; i < n; i++) {
        printf("%d. %s (%d) - Género: %s\n", i + 1,
               peliculas[i].titulo, peliculas[i].anio, peliculas[i].genero);
        printf("   Directores: ");
        for (int j = 0; j < peliculas[i].numDirectores; j++) {
            printf("%s", peliculas[i].directores[j]);
            if (j < peliculas[i].numDirectores - 1) printf(", ");
        }
        printf("\n");
    }
}

void mostrarPeliculasInverso(struct Pelicula peliculas[], int n) {
    printf("\n--- Lista de películas (orden inverso) ---\n");
    for (int i = n - 1; i >= 0; i--) {
        printf("%d. %s (%d) - Género: %s\n", i + 1,
               peliculas[i].titulo, peliculas[i].anio, peliculas[i].genero);
        printf("   Directores: ");
        for (int j = 0; j < peliculas[i].numDirectores; j++) {
            printf("%s", peliculas[i].directores[j]);
            if (j < peliculas[i].numDirectores - 1) printf(", ");
        }
        printf("\n");
    }
}


void buscarPorTitulo(struct Pelicula peliculas[], int n, char titulo[]) { // funcion buscar por el titulo 
    char tituloLower[MAX_LEN];
    strcpy(tituloLower, titulo);
    toLowerCase(tituloLower);

    int encontrado = 0;
    for (int i = 0; i < n; i++) {
        char tituloPelicula[MAX_LEN];
        strcpy(tituloPelicula, peliculas[i].titulo);
        toLowerCase(tituloPelicula);

        if (strcmp(tituloPelicula, tituloLower) == 0) {
            printf("✔ %s (%d) - Género: %s\n",
                   peliculas[i].titulo, peliculas[i].anio, peliculas[i].genero);
            encontrado = 1;
        }
    }
    if (!encontrado) printf("No se encontraron películas con ese título.\n");
}

void buscarPorGenero(struct Pelicula peliculas[], int n, char genero[]) { //funcion buscar por genero 
    char generoLower[MAX_LEN];
    strcpy(generoLower, genero);
    toLowerCase(generoLower);

    int encontrado = 0;
    for (int i = 0; i < n; i++) {
        char generoPelicula[MAX_LEN];
        strcpy(generoPelicula, peliculas[i].genero);
        toLowerCase(generoPelicula);

        if (strcmp(generoPelicula, generoLower) == 0) {
            printf("✔ %s (%d) - Género: %s\n",
                   peliculas[i].titulo, peliculas[i].anio, peliculas[i].genero);
            encontrado = 1;
        }
    }
    if (!encontrado) printf("No se encontraron películas con ese género.\n");
}

void buscarPorAnio(struct Pelicula peliculas[], int n, int anio) { //funcion buscar por año
    int encontrado = 0;
    for (int i = 0; i < n; i++) {
        if (peliculas[i].anio == anio) {
            printf("✔ %s (%d) - Género: %s\n",
                   peliculas[i].titulo, peliculas[i].anio, peliculas[i].genero);
            encontrado = 1;
        }
    }
    if (!encontrado) printf("No se encontraron películas de ese año.\n");
}

void buscarPorDirector(struct Pelicula peliculas[], int n, char director[]) { //funcion buscar por director
    char directorLower[MAX_LEN];
    strcpy(directorLower, director);
    toLowerCase(directorLower);

    int encontrado = 0;
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < peliculas[i].numDirectores; j++) {
            char directorPelicula[MAX_LEN];
            strcpy(directorPelicula, peliculas[i].directores[j]);
            toLowerCase(directorPelicula);

            if (strcmp(directorPelicula, directorLower) == 0) {
                printf("%s (%d) - Género: %s\n",
                       peliculas[i].titulo, peliculas[i].anio, peliculas[i].genero);
                encontrado = 1;
                break;
            }
        }
    }
    if (!encontrado) printf("No se encontraron películas con ese director.\n");
}

void contarPorGenero(struct Pelicula peliculas[], int n) {
    printf("\n--- Conteo de películas por género ---\n");
    for (int i = 0; i < n; i++) {
        int contador = 1;
        int yaContado = 0;

        char generoActual[MAX_LEN];
        strcpy(generoActual, peliculas[i].genero);
        toLowerCase(generoActual);

        // Revisar si ya contamos este género antes
        for (int k = 0; k < i; k++) {
            char generoPrevio[MAX_LEN];
            strcpy(generoPrevio, peliculas[k].genero);
            toLowerCase(generoPrevio);

            if (strcmp(generoActual, generoPrevio) == 0) {
                yaContado = 1;
                break;
            }
        }
        if (yaContado) continue;

        // Contar cuántas veces aparece este género
        for (int j = i + 1; j < n; j++) {
            char generoComparar[MAX_LEN];
            strcpy(generoComparar, peliculas[j].genero);
            toLowerCase(generoComparar);

            if (strcmp(generoActual, generoComparar) == 0) {
                contador++;
            }
        }

        printf("Género %s: %d película(s)\n", peliculas[i].genero, contador);
    }
}


int main() {
    struct Pelicula peliculas[MAX_PELICULAS];
    int n, opcion;

    do {
        printf("¿Cuántas películas deseas ingresar? (mínimo %d, máximo %d): ",
               MIN_PELICULAS, MAX_PELICULAS);
        scanf("%d", &n);
    } while (n < MIN_PELICULAS || n > MAX_PELICULAS );

    getchar(); 

    //pedir nombre titulo año genero y directores
    for (int i = 0; i < n; i++) {
        printf("\nPelícula %d:\n", i + 1);

        printf("Título: ");
        fgets(peliculas[i].titulo, sizeof(peliculas[i].titulo), stdin);
        peliculas[i].titulo[strcspn(peliculas[i].titulo, "\n")] = 0;

        printf("Año: ");
        scanf("%d", &peliculas[i].anio);
        getchar();

        printf("Género: ");
        fgets(peliculas[i].genero, sizeof(peliculas[i].genero), stdin);
        peliculas[i].genero[strcspn(peliculas[i].genero, "\n")] = 0;

        do {
            printf("¿Cuántos directores tiene esta película? (1 - %d): ", MAX_DIRECTORES);
            scanf("%d", &peliculas[i].numDirectores);
        } while (peliculas[i].numDirectores < 1 || peliculas[i].numDirectores > MAX_DIRECTORES);

        getchar();
        for (int j = 0; j < peliculas[i].numDirectores; j++) {
            printf("Director %d: ", j + 1);
            fgets(peliculas[i].directores[j], sizeof(peliculas[i].directores[j]), stdin);
            peliculas[i].directores[j][strcspn(peliculas[i].directores[j], "\n")] = 0;
        }
    }

    // Menú de búsqueda
    do {
        printf("\n ¿Que desea hacer?\n");
        printf("1. Mostrar todas las películas\n");
        printf("2. Buscar por título\n");
        printf("3. Buscar por género\n");
        printf("4. Buscar por año\n");
        printf("5. Buscar por director\n");
        printf("6. Mostrar todas las peliculas de forma inversa");
        printf("7. Contar peliculas por genero");
        printf("0. Salir\n");
        printf("Opción: ");
        scanf("%d", &opcion);
        getchar();

        if (opcion == 1) {
            mostrarPeliculas(peliculas, n); //llamamos a la funcion para mostrar peliculas
        } else if (opcion == 2) {
            char titulo[MAX_LEN];
            printf("Ingrese título a buscar: ");
            fgets(titulo, sizeof(titulo), stdin);
            titulo[strcspn(titulo, "\n")] = 0;
            buscarPorTitulo(peliculas, n, titulo);//llamamos a la funcion buscar por titulo
        } else if (opcion == 3) {
            char genero[MAX_LEN];
            printf("Ingrese género a buscar: ");
            fgets(genero, sizeof(genero), stdin);
            genero[strcspn(genero, "\n")] = 0;
            buscarPorGenero(peliculas, n, genero);//llamamos a la funcion buscar por genero
        } else if (opcion == 4) {
            int anio;
            printf("Ingrese año a buscar: ");
            scanf("%d", &anio);
            buscarPorAnio(peliculas, n, anio);//llamamos a la funcion buscar por año
        } else if (opcion == 5) {
            char director[MAX_LEN];
            printf("Ingrese director a buscar: ");
            fgets(director, sizeof(director), stdin);
            director[strcspn(director, "\n")] = 0;
            buscarPorDirector(peliculas, n, director);//llamamos a la funcion buscar por director
        } else if (opcion == 6){
            mostrarPeliculasInverso(peliculas, n);
        } else if(opcion ==7){
            contarPorGenero(peliculas, n);
        }
        
    } while (opcion != 0);

    return 0;       //apiadese de mi me llevo horas y errores hacer esto :c  y por ahi me salto un error de bucle
                    //cuando en lugar de poner un entero en cuantos directores son poner un caracter se hace
                    //un bucle preguntado cuantos directores son pero solo salta de vez en cuando
}
